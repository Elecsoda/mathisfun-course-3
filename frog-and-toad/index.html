<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é’è›™ä¸èŸ¾èœé€»è¾‘æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #e0f2fe; /* light blue */
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 20px 20px;
            overscroll-behavior: none;
        }

        .game-container {
            perspective: 1000px;
        }

        .slot {
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .animal {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
            pointer-events: none; 
        }

        .slot:active .animal {
            transform: scale(0.95);
        }
        
        .frozen .slot, .running .slot {
            cursor: default;
            pointer-events: none;
        }

        .lily-pad {
            background: linear-gradient(135deg, #166534 0%, #14532d 100%);
            box-shadow: 0 2px 0 #052e16;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(to bottom, #3b82f6, #2563eb);
            border-bottom: 4px solid #1d4ed8;
            transition: transform 0.1s, border-bottom-width 0.1s;
        }
        .btn-primary:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        .btn-success {
            background: linear-gradient(to bottom, #22c55e, #16a34a);
            border-bottom: 4px solid #15803d;
            transition: transform 0.1s, border-bottom-width 0.1s;
        }
        .btn-success:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }
        
        .btn-disabled {
            background: #94a3b8;
            border-bottom: 4px solid #64748b;
            cursor: not-allowed;
            transform: none !important;
        }

        @keyframes pop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .win-modal {
            animation: pop 0.5s ease-out forwards;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(4px);
        }

        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #bae6fd;
            border-radius: 2px;
        }
        
        /* Sequence Highlight Styles */
        .seq-char {
            display: inline-block;
            transition: all 0.2s;
            padding: 0 1px;
        }
        .seq-active {
            color: #dc2626; /* Red-600 */
            font-weight: 900;
            transform: scale(1.5);
            text-shadow: 0 0 10px rgba(220, 38, 38, 0.3);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-2 md:p-4">

    <!-- Header -->
    <div class="text-center mb-4 md:mb-6 mt-4">
        <h1 class="text-2xl md:text-4xl font-bold text-sky-900 mb-1 drop-shadow-sm">é’è›™ä¸èŸ¾èœ</h1>
        <p class="text-sky-700 text-xs md:text-base max-w-lg mx-auto px-2">
            é’è›™ï¼ˆç»¿è‰²ï¼‰åªèƒ½å‘å³ï¼ŒèŸ¾èœï¼ˆè¤è‰²ï¼‰åªèƒ½å‘å·¦ã€‚<br class="hidden md:inline">
            å¯å‰è¿›ä¸€æ­¥æˆ–è·³è¿‡ä¸€ä¸ªå¼‚è‰²åŒä¼´ã€‚
        </p>
    </div>

    <!-- Main Controls Panel -->
    <div class="glass-panel w-full max-w-lg p-3 rounded-2xl shadow-sm mx-2 mb-4 flex flex-col gap-3">
        
        <!-- Game Settings Row -->
        <div class="flex flex-wrap items-center justify-between gap-2">
            <div class="flex items-center gap-2">
                <label class="text-sky-800 font-bold text-sm whitespace-nowrap">æ•°é‡:</label>
                <select id="count-selector" class="bg-white border border-sky-300 text-sky-800 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-1.5 md:p-2 w-28 md:w-32">
                    <option value="2">2 å¯¹</option>
                    <option value="3" selected>3 å¯¹</option>
                    <option value="4">4 å¯¹</option>
                    <option value="5">5 å¯¹</option>
                    <option value="6">6 å¯¹</option>
                    <option value="7">7 å¯¹</option>
                </select>
            </div>
            <button onclick="game.reset()" class="btn-primary px-4 py-1.5 rounded-lg text-white font-bold text-sm shadow-md flex-1 md:flex-none">
                é‡ç½®
            </button>
        </div>

        <!-- Auto Play Row -->
        <div class="flex flex-col gap-2 pt-2 border-t border-sky-100">
            <div class="flex items-center gap-2">
                <div class="relative flex-1 h-[38px]">
                    <!-- Input Mode -->
                    <input type="number" id="auto-sequence" placeholder="è¾“å…¥åºåˆ— (å¦‚ 123)" class="absolute inset-0 w-full bg-white border border-sky-300 text-sky-800 text-sm rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500 shadow-inner" onkeypress="if(event.key === 'Enter') game.runSequence()">
                    
                    <!-- Display Mode (Hidden by default) -->
                    <div id="sequence-display" class="absolute inset-0 w-full bg-white border border-sky-300 text-sky-800 text-sm rounded-lg p-2 shadow-inner hidden overflow-hidden whitespace-nowrap flex items-center">
                        <!-- Spans injected here -->
                    </div>
                </div>
                <button id="btn-run" onclick="game.runSequence()" class="btn-success px-3 py-2 rounded-lg text-white font-bold text-sm shadow-md whitespace-nowrap">
                    æ‰§è¡Œè·³è·ƒ
                </button>
            </div>
            
            <!-- Speed Control -->
            <div class="flex items-center gap-3 px-1">
                <span class="text-xs text-sky-600 font-bold">é€Ÿåº¦:</span>
                <span class="text-xs text-sky-400">æ…¢</span>
                <input type="range" id="speed-control" min="200" max="1500" value="800" class="flex-1 h-2 bg-sky-200 rounded-lg appearance-none cursor-pointer">
                <span class="text-xs text-sky-400">å¿«</span>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="flex justify-between w-full max-w-5xl px-3 md:px-4 mb-2 text-sky-800 font-bold text-sm md:text-base relative min-h-[1.5rem]">
        <span>æ­¥æ•°: <span id="move-count">0</span></span>
        
        <!-- Instruction Indicator Bubble -->
        <span id="instruction-display" class="hidden absolute left-1/2 -translate-x-1/2 top-[-4px] text-purple-700 bg-white/95 border border-purple-200 px-4 py-1 rounded-full shadow-md z-20 whitespace-nowrap transition-all duration-200">
            æ­£åœ¨æ‰§è¡Œ: <span id="current-digit" class="text-xl font-black text-purple-600"></span>
        </span>

        <span id="game-status" class="text-orange-600 font-bold animate-pulse hidden">æ­»å±€!</span>
    </div>

    <!-- Game Board Area -->
    <div class="relative w-full max-w-5xl bg-sky-200/50 rounded-xl md:rounded-3xl shadow-inner border border-sky-300 overflow-hidden">
        
        <!-- Water reflection effect -->
        <div class="absolute inset-0 opacity-30 pointer-events-none">
             <div class="absolute top-4 left-10 w-24 h-4 bg-white rounded-full blur-xl"></div>
             <div class="absolute bottom-10 right-20 w-32 h-6 bg-white rounded-full blur-xl"></div>
        </div>

        <!-- The Grid -->
        <div id="board" class="game-container flex justify-between items-end relative z-10 px-1 py-2 md:p-4 mx-auto transition-all duration-300">
            <!-- Generated via JS -->
        </div>
    </div>

    <!-- Footer -->
    <div class="w-full text-center text-sky-700/50 text-xs mt-auto pt-8 pb-4">
        @å­™ç»´åˆšæ•™è‚²ç ”ç©¶é™¢
    </div>

    <!-- Win Message Overlay -->
    <div id="win-message" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm hidden px-4">
        <div class="win-modal bg-white rounded-2xl p-6 md:p-8 text-center shadow-2xl w-full max-w-sm relative overflow-hidden border-4 border-yellow-400">
            <div class="absolute top-0 left-0 w-full h-4 bg-yellow-400"></div>
            <div class="text-5xl mb-4">ğŸ‘‘</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">æ­å–œèƒœåˆ©!</h2>
            <p class="text-gray-600 mb-6">éš¾åº¦: <span id="final-level" class="font-bold"></span> å¯¹<br>æ­¥æ•°: <span id="final-moves" class="font-bold text-blue-600">0</span></p>
            <button onclick="game.reset()" class="btn-primary w-full py-3 rounded-xl text-white font-bold shadow-lg">
                å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        // Constants for SVG graphics
        const FROG_SVG = `
            <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-sm">
                <g class="frog-body">
                    <path d="M20,75 Q10,65 15,55 Q20,30 50,30 Q80,30 85,55 Q90,65 80,75 Z" fill="#4ade80" stroke="#166534" stroke-width="3"/>
                    <circle cx="35" cy="35" r="8" fill="white" stroke="#166534" stroke-width="1.5"/>
                    <circle cx="35" cy="35" r="3.5" fill="black"/>
                    <circle cx="65" cy="35" r="8" fill="white" stroke="#166534" stroke-width="1.5"/>
                    <circle cx="65" cy="35" r="3.5" fill="black"/>
                    <path d="M40,55 Q50,65 60,55" fill="none" stroke="#166534" stroke-width="3" stroke-linecap="round"/>
                    <ellipse cx="20" cy="75" rx="15" ry="8" fill="#4ade80" stroke="#166534" stroke-width="2"/>
                    <ellipse cx="80" cy="75" rx="15" ry="8" fill="#4ade80" stroke="#166534" stroke-width="2"/>
                </g>
            </svg>
        `;

        const TOAD_SVG = `
            <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-sm">
                <g class="toad-body">
                    <path d="M15,75 Q5,65 10,55 Q20,25 50,25 Q80,25 90,55 Q95,65 85,75 Z" fill="#a16207" stroke="#451a03" stroke-width="3"/>
                    <circle cx="30" cy="45" r="3" fill="#713f12" opacity="0.6"/>
                    <circle cx="70" cy="50" r="4" fill="#713f12" opacity="0.6"/>
                    <circle cx="50" cy="35" r="2.5" fill="#713f12" opacity="0.6"/>
                    
                    <circle cx="35" cy="32" r="7" fill="#fef3c7" stroke="#451a03" stroke-width="1.5"/>
                    <circle cx="35" cy="32" r="2.5" fill="black"/>
                    <circle cx="65" cy="32" r="7" fill="#fef3c7" stroke="#451a03" stroke-width="1.5"/>
                    <circle cx="65" cy="32" r="2.5" fill="black"/>
                    <path d="M35,60 Q50,50 65,60" fill="none" stroke="#451a03" stroke-width="3" stroke-linecap="round"/>
                    <ellipse cx="15" cy="75" rx="15" ry="9" fill="#a16207" stroke="#451a03" stroke-width="2"/>
                    <ellipse cx="85" cy="75" rx="15" ry="9" fill="#a16207" stroke="#451a03" stroke-width="2"/>
                </g>
            </svg>
        `;

        class FrogGame {
            constructor() {
                this.count = 3; 
                this.board = []; 
                this.moves = 0;
                this.gameWon = false;
                this.isRunning = false;
                
                this.boardEl = document.getElementById('board');
                this.countSelector = document.getElementById('count-selector');
                this.moveEl = document.getElementById('move-count');
                this.winMsg = document.getElementById('win-message');
                this.statusEl = document.getElementById('game-status');
                
                // Controls
                this.inputEl = document.getElementById('auto-sequence');
                this.displayEl = document.getElementById('sequence-display');
                this.runBtn = document.getElementById('btn-run');
                this.speedEl = document.getElementById('speed-control');
                
                // Indicators
                this.instructEl = document.getElementById('instruction-display');
                this.digitEl = document.getElementById('current-digit');

                this.countSelector.addEventListener('change', (e) => {
                    this.count = parseInt(e.target.value);
                    this.reset();
                });

                this.reset();
            }

            reset() {
                if(this.isRunning) return;
                this.moves = 0;
                this.gameWon = false;
                this.updateUIStats();
                this.winMsg.classList.add('hidden');
                this.boardEl.classList.remove('frozen');
                this.boardEl.classList.remove('running');
                this.statusEl.classList.add('hidden');
                this.instructEl.classList.add('hidden');
                
                this.inputEl.value = '';
                this.displayEl.innerHTML = '';
                
                this.toggleControls(true);
                
                // Initialize board
                this.board = [];
                for (let i = 0; i < this.count; i++) this.board.push(1);
                this.board.push(0);
                for (let i = 0; i < this.count; i++) this.board.push(2);

                this.render();
            }

            toggleControls(enabled) {
                if (enabled) {
                    this.inputEl.classList.remove('hidden');
                    this.displayEl.classList.add('hidden');
                    this.countSelector.disabled = false;
                    this.runBtn.classList.remove('btn-disabled');
                    this.runBtn.innerText = 'æ‰§è¡Œè·³è·ƒ';
                } else {
                    this.inputEl.classList.add('hidden');
                    this.displayEl.classList.remove('hidden');
                    this.countSelector.disabled = true;
                    this.runBtn.classList.add('btn-disabled');
                    this.runBtn.innerText = 'æ‰§è¡Œä¸­...';
                }
            }

            getSpeed() {
                // Range is 200 (fast) to 1500 (slow)
                // We inverse it slightly for "Fast" label logic if needed, but simple is ok.
                // Left is 200 (Fast? Wait no, left should be slow, right fast usually? )
                // User requirement: "Can adjust speed".
                // Label says "Slow" (Left) -> "Fast" (Right).
                // So Left Value should be high (long delay), Right Value low (short delay).
                // HTML input: min=200 max=1500.
                // Let's interpret the slider visually: Left(Slow) = 1500ms, Right(Fast) = 200ms.
                const val = parseInt(this.speedEl.value);
                // Invert the value logic to match labels
                // min(200) + max(1500) = 1700. 
                // If slider is at left (min=200), we want 1500ms delay.
                // If slider is at right (max=1500), we want 200ms delay.
                return 1700 - val;
            }

            wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            async runSequence() {
                if (this.isRunning || this.gameWon) return;
                
                const sequenceStr = this.inputEl.value.trim();
                if (!sequenceStr) {
                    alert("è¯·è¾“å…¥è·³è·ƒåºåˆ—ï¼Œä¾‹å¦‚: 123");
                    return;
                }

                this.isRunning = true;
                this.boardEl.classList.add('running');
                this.toggleControls(false);
                this.instructEl.classList.remove('hidden');

                // Build Display HTML
                this.displayEl.innerHTML = '';
                const spanEls = [];
                for (let char of sequenceStr) {
                    const span = document.createElement('span');
                    span.textContent = char;
                    span.className = 'seq-char font-mono text-gray-400';
                    this.displayEl.appendChild(span);
                    spanEls.push(span);
                }

                let turnType = 1; // 1 = Frog, 2 = Toad

                for (let i = 0; i < sequenceStr.length; i++) {
                    if (this.gameWon) break;

                    const moveCount = parseInt(sequenceStr[i]);
                    
                    // Highlight current instruction in the sequence list
                    spanEls.forEach(s => s.classList.remove('seq-active', 'text-gray-800'));
                    if (spanEls[i]) {
                        spanEls[i].classList.add('seq-active');
                    }
                    
                    // Update Bubble text
                    this.digitEl.textContent = sequenceStr[i];
                    
                    if (isNaN(moveCount)) continue;

                    // Execute 'moveCount' moves for 'turnType'
                    for (let m = 0; m < moveCount; m++) {
                        
                        // Find best move for current type
                        const moved = await this.autoMoveOneStep(turnType);
                        
                        if (!moved) {
                            this.statusEl.textContent = `åºåˆ—åœ¨ç¬¬ ${i+1} ç»„æŒ‡ä»¤ä¸­æ–­: æ— æ³•ç§»åŠ¨`;
                            this.statusEl.classList.remove('hidden');
                            this.isRunning = false;
                            this.toggleControls(true);
                            this.boardEl.classList.remove('running');
                            this.instructEl.classList.add('hidden');
                            return;
                        }

                        // Wait AFTER the move starts, for animation to complete + user delay
                        const delay = this.getSpeed();
                        await this.wait(delay); 
                    }

                    // Toggle turn
                    turnType = turnType === 1 ? 2 : 1;
                }

                this.isRunning = false;
                this.boardEl.classList.remove('running');
                this.toggleControls(true);
                this.instructEl.classList.add('hidden');
            }

            // Logic to find and move one animal of specific type
            async autoMoveOneStep(type) {
                // Find all animals of 'type' that CAN move
                let candidates = [];
                
                for(let i=0; i<this.board.length; i++) {
                    if (this.board[i] === type) {
                        if (this.canMove(i)) {
                            candidates.push(i);
                        }
                    }
                }

                if (candidates.length === 0) return false;

                // Selection Strategy based on "Front to Back"
                let bestIndex = -1;
                if (type === 1) {
                    bestIndex = Math.max(...candidates);
                } else {
                    bestIndex = Math.min(...candidates);
                }

                this.handleMove(bestIndex);
                return true;
            }

            canMove(index) {
                const type = this.board[index];
                if (type === 1) { // Frog moves Right
                    if (index + 1 < this.board.length && this.board[index + 1] === 0) return true;
                    if (index + 2 < this.board.length && this.board[index + 2] === 0 && this.board[index + 1] === 2) return true;
                } else if (type === 2) { // Toad moves Left
                    if (index - 1 >= 0 && this.board[index - 1] === 0) return true;
                    if (index - 2 >= 0 && this.board[index - 2] === 0 && this.board[index - 1] === 1) return true;
                }
                return false;
            }

            checkDeadlock() {
                if (this.checkWin()) return false;
                
                for (let i = 0; i < this.board.length; i++) {
                    if (this.board[i] !== 0 && this.canMove(i)) return false;
                }
                return true;
            }

            checkWin() {
                const len = this.board.length;
                
                for(let i=0; i<this.count; i++) {
                    if(this.board[i] !== 2) return false;
                }
                if(this.board[this.count] !== 0) return false;
                for(let i=this.count+1; i<len; i++) {
                    if(this.board[i] !== 1) return false;
                }
                return true;
            }

            handleMove(index) {
                if (this.gameWon) return;
                // Allow moves if running automatically (controlled by script) or manually (if not running)
                if (this.isRunning && !this.boardEl.classList.contains('running')) return; 

                const type = this.board[index];
                if (type === 0) return; 

                let newIndex = -1;

                if (type === 1) { 
                    // Frog moves Right
                    if (index + 1 < this.board.length && this.board[index + 1] === 0) {
                        newIndex = index + 1;
                    } else if (index + 2 < this.board.length && this.board[index + 2] === 0 && this.board[index + 1] === 2) {
                        newIndex = index + 2;
                    }
                } else if (type === 2) {
                    // Toad moves Left
                    if (index - 1 >= 0 && this.board[index - 1] === 0) {
                        newIndex = index - 1;
                    } else if (index - 2 >= 0 && this.board[index - 2] === 0 && this.board[index - 1] === 1) {
                        newIndex = index - 2;
                    }
                }

                if (newIndex !== -1) {
                    this.board[newIndex] = type;
                    this.board[index] = 0;
                    this.moves++;
                    this.updateUIStats();
                    this.render();

                    if (this.checkWin()) {
                        this.gameWon = true;
                        this.boardEl.classList.add('frozen');
                        document.getElementById('final-moves').textContent = this.moves;
                        document.getElementById('final-level').textContent = this.count;
                        setTimeout(() => {
                            this.winMsg.classList.remove('hidden');
                        }, 300);
                    } else if (this.checkDeadlock()) {
                        this.statusEl.textContent = "æ— æ³•ç§»åŠ¨äº†! è¯·é‡ç½®ã€‚";
                        this.statusEl.classList.remove('hidden');
                    }
                } else {
                    // Shake logic
                    const el = document.getElementById(`slot-${index}`);
                    if(el) {
                        const animalDiv = el.querySelector('.animal');
                        if (animalDiv) {
                            animalDiv.style.transform = type === 2 ? "scaleX(-1) translateX(-5px)" : "translateX(5px)";
                            setTimeout(() => animalDiv.style.transform = type === 2 ? "scaleX(-1) translateX(5px)" : "translateX(-5px)", 50);
                            setTimeout(() => animalDiv.style.transform = type === 2 ? "scaleX(-1) translateX(0)" : "translateX(0)", 100);
                        }
                    }
                }
            }

            updateUIStats() {
                this.moveEl.textContent = this.moves;
            }

            render() {
                this.boardEl.innerHTML = '';
                
                const totalSlots = (this.count * 2) + 1;
                const slotWidthPercent = 100 / totalSlots;
                
                const isMobile = window.innerWidth < 768;
                let minHeight = isMobile ? (totalSlots > 10 ? '60px' : '90px') : '140px';
                
                this.boardEl.style.minHeight = minHeight;

                this.board.forEach((item, index) => {
                    const slot = document.createElement('div');
                    slot.id = `slot-${index}`;
                    slot.className = `slot relative flex flex-col items-center justify-end h-full select-none ${item !== 0 ? 'cursor-pointer' : ''}`;
                    slot.style.width = `${slotWidthPercent}%`;
                    slot.style.height = isMobile ? (100/totalSlots * 2.5 + 'vw') : 'auto'; 
                    if (!isMobile) slot.style.height = '140px'; 
                    slot.style.maxHeight = '160px'; 
                    
                    if (!this.isRunning && !this.gameWon) {
                        slot.onclick = () => this.handleMove(index);
                    }

                    // Create Lily Pad
                    const pad = document.createElement('div');
                    pad.className = 'lily-pad w-[90%] h-[20%] rounded-[50%] absolute bottom-1 md:bottom-2 z-0';
                    slot.appendChild(pad);

                    // Create Animal
                    if (item !== 0) {
                        const animal = document.createElement('div');
                        animal.className = 'animal absolute z-10 w-full aspect-square bottom-1 md:bottom-2 flex items-center justify-center';
                        
                        if (item === 1) {
                            animal.innerHTML = FROG_SVG;
                        } else {
                            const wrapper = document.createElement('div');
                            wrapper.className = 'w-full h-full';
                            wrapper.style.transform = 'scaleX(-1)'; 
                            wrapper.innerHTML = TOAD_SVG;
                            animal.appendChild(wrapper);
                        }
                        slot.appendChild(animal);
                    }

                    this.boardEl.appendChild(slot);
                });
            }
        }

        window.addEventListener('resize', () => {
            if (game) game.render();
        });

        const game = new FrogGame();

    </script>
</body>
</html>