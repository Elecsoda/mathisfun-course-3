<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- æ ¸å¿ƒé€‚é…ï¼šè®¾ç½®ç§»åŠ¨ç«¯è§†å£ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‡¯æ’’å¯†ç å·¥å…·</title>
    <style>
        /* ================= åŸºç¡€æ ·å¼é€‚é… ================= */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7fa;
            color: #333;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 100%; /* æ‰‹æœºç«¯å æ»¡å®½åº¦ */
            margin: 0 auto;
            padding: 15px;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin: 20px 0;
            font-size: 1.5rem;
        }

        h2 {
            color: #34495e;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        /* ================= å¡ç‰‡å¼å¸ƒå±€ ================= */
        .mode {
            background-color: white;
            padding: 20px; /* å¢åŠ å†…è¾¹è· */
            border-radius: 12px; /* åœ†è§’æ›´åœ†æ¶¦ */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }

        /* ================= è¡¨å•é€‚é… ================= */
        /* æ‰‹æœºç«¯é»˜è®¤ç«–å‘æ’åˆ—ï¼Œæ ‡ç­¾åœ¨è¾“å…¥æ¡†ä¸Šæ–¹ */
        .form-row {
            display: flex;
            flex-direction: column; 
            align-items: flex-start;
            margin-bottom: 15px;
        }

        label {
            font-size: 15px;
            margin-bottom: 8px; /* æ ‡ç­¾å’Œè¾“å…¥æ¡†æ‹‰å¼€è·ç¦» */
            margin-right: 0;
            width: 100%;
            text-align: left;
            font-weight: 600;
            color: #555;
        }

        input[type="number"],
        input[type="text"] {
            padding: 12px; /* å¢å¤§ç‚¹å‡»åŒºåŸŸ */
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px; /* 16px é˜²æ­¢ iOS è¾“å…¥æ¡†è‡ªåŠ¨æ”¾å¤§ */
            width: 100%;
            box-sizing: border-box; /* ç¡®ä¿paddingåŒ…å«åœ¨å®½åº¦å†… */
            background-color: #f9f9f9;
            -webkit-appearance: none;
        }

        input:focus {
            border-color: #3498db;
            background-color: #fff;
            outline: none;
        }

        /* ================= æ¨¡å¼1ï¼šå­—æ¯è¡¨é€‚é… ================= */
        .alphabet-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* å·¦å¯¹é½ï¼Œé…åˆæ»šåŠ¨ */
            
            /* å…³é”®ï¼šå…è®¸æ¨ªå‘æ»šåŠ¨ï¼Œæ˜¾ç¤ºå®Œæ•´26ä¸ªå­—æ¯ */
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch; /* iOSæµç•…æ»šåŠ¨ */
            
            width: 100%;
            padding-bottom: 10px;
            background-color: #fafafa;
            border-radius: 8px;
            border: 1px solid #eee;
            padding: 10px;
            box-sizing: border-box;
        }

        .alphabet-row {
            display: flex;
            /* width: max-content; ç¡®ä¿å†…å®¹æ’‘å¼€å®½åº¦ï¼Œä¸æ¢è¡Œ */
            width: max-content; 
            margin: 5px 0;
        }

        .alphabet-row div {
            width: 34px;
            height: 34px;
            text-align: center;
            line-height: 34px;
            margin: 2px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background-color: #fff;
            font-size: 14px;
            flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
            transition: background-color 0.2s;
        }

        /* ç»“æœåŒºåŸŸ */
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fc;
            color: #2c3e50;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            font-weight: bold;
            word-break: break-all;
        }

        /* ================= æ¨¡å¼2ï¼šåˆ—é˜Ÿé€‚é… ================= */
        .columns-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 10px;
            background-color: #fafafa;
            border-radius: 8px;
            border: 1px solid #eee;
            padding: 10px;
            box-sizing: border-box;
        }

        .columns-container {
            display: inline-flex;
            gap: 8px; /* åˆ—é—´è· */
            justify-content: flex-start;
            align-items: flex-start;
        }

        .column {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }

        .column div {
            width: 32px;
            height: 32px;
            text-align: center;
            line-height: 32px;
            margin: 1px 0;
            border: 1px solid #ccc; /* ä¿æŒåŸè¾¹æ¡† */
            border-radius: 4px;
            background-color: #fff;
            font-size: 13px;
        }

        .blank-column {
            width: 20px;
            height: 32px;
            flex-shrink: 0;
        }

        /* ================= é«˜äº®æ ·å¼ä¿ç•™ ================= */
        /* æ¨¡å¼2ç”¨åˆ°çš„é«˜äº®ç±» */
        .highlight-cipher {
            background-color: #e67e22 !important;
            color: white;
            font-weight: bold;
            border-color: #d35400 !important;
        }

        .highlight-plain {
            background-color: #27ae60 !important;
            color: white;
            font-weight: bold;
            border-color: #27ae60 !important;
            transform: scale(1.05); /* ç¨å¾®æ”¾å¤§ä¸€ç‚¹ç‚¹ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1;
        }

        /* ================= å¹³æ¿/æ¡Œé¢ç«¯ä¼˜åŒ– ================= */
        /* å½“å±å¹•è¶³å¤Ÿå®½æ—¶ï¼Œæ¢å¤æ¨ªå‘æ’åˆ— */
        @media (min-width: 768px) {
            .container {
                max-width: 900px;
            }
            .form-row {
                flex-direction: row;
                align-items: center;
                justify-content: center;
            }
            label {
                width: 200px;
                margin-bottom: 0;
                text-align: right;
                margin-right: 15px;
            }
            input[type="number"],
            input[type="text"] {
                width: 60%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å‡¯æ’’å¯†ç å·¥å…·</h1>

        <!-- æ¨¡å¼1 -->
        <div id="mode1" class="mode">
            <h2>æ¨¡å¼1 - å·²çŸ¥å¯†é’¥</h2>
            <div class="form-row">
                <label for="input1">è¾“å…¥æ˜æ–‡æˆ–å¯†æ–‡:</label>
                <input type="text" id="input1" oninput="updateMode1()" placeholder="è¯·è¾“å…¥...">
            </div>
            <div class="form-row">
                <label for="key1">å¯†é’¥ (è´Ÿæ•°å‘å‰ç§»åŠ¨):</label>
                <input type="number" id="key1" value="3" oninput="updateMode1()">
            </div>
            
            <!-- è¿™é‡Œå¯ä»¥æ¨ªå‘æ»šåŠ¨æŸ¥çœ‹æ‰€æœ‰26ä¸ªå­—æ¯ -->
            <div class="alphabet-container">
                <div class="alphabet-row" id="plaintext-row"></div>
                <div class="alphabet-row" id="ciphertext-row"></div>
            </div>
            
            <div class="result" id="result1">ç¼–ç ç»“æœ: </div>
        </div>

        <!-- æ¨¡å¼2 -->
        <div id="mode2" class="mode">
            <h2>æ¨¡å¼2 - æœªçŸ¥å¯†é’¥</h2>
            <div class="form-row">
                <label for="ciphertext2">è¾“å…¥å¯†æ–‡:</label>
                <input type="text" id="ciphertext2" oninput="updateMode2Columns()" placeholder="ä¾‹å¦‚: KHOOR">
            </div>
            <div class="form-row">
                <label for="key2">è¾“å…¥å¯†é’¥ (è´Ÿæ•°å‘åç§»åŠ¨):</label>
                <input type="number" id="key2" value="0" oninput="updateMode2Highlight()">
            </div>
            
            <div class="columns-wrapper">
                <div class="columns-container" id="columns-container">
                    <!-- JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // JavaScript é€»è¾‘å®Œå…¨ä¿ç•™åŸç‰ˆ
        // ============================================================

        // é¢œè‰²æ•°ç»„
        const colors = [
            '#e6194B', '#3cb44b', '#ffe119', '#4363d8', '#f58231',
            '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe',
            '#008080', '#e6beff', '#9A6324', '#fffac8', '#800000',
            '#aaffc3', '#808000', '#ffd8b1', '#000075', '#808080',
            '#ffffff', '#000000', '#FF5733', '#33FF57', '#3357FF'
        ];

        // åˆå§‹åŒ–è¿è¡Œä¸€æ¬¡ï¼Œæ˜¾ç¤ºé»˜è®¤å­—æ¯è¡¨
        window.onload = function() {
            updateMode1();
        };

        // ========================
        // æ¨¡å¼1 åŠŸèƒ½ (é€»è¾‘æ¢å¤åŸæ ·)
        // ========================
        function updateMode1() {
            const key = parseInt(document.getElementById('key1').value) || 0;
            const input = document.getElementById('input1').value.toUpperCase();
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            const shifted = shiftAlphabet(alphabet, key);

            // æ¢å¤é€»è¾‘ï¼šä¸Šä¸‹ä¸¤è¡Œæ˜¾ç¤ºçš„éƒ½æ˜¯æ ‡å‡† A-Z å­—æ¯è¡¨
            // åç§»é€šè¿‡é«˜äº®ä¸åŒä½ç½®æ¥ä½“ç°
            updateAlphabetRow('plaintext-row', alphabet);
            updateAlphabetRow('ciphertext-row', alphabet); 

            // é«˜äº®å¯¹åº”å­—æ¯
            highlightAlphabet(input, alphabet, shifted, 'plaintext-row', 'ciphertext-row', key);

            // è¾“å‡ºç¼–ç ç»“æœ
            const result = input.split('').map(char => {
                const index = alphabet.indexOf(char);
                return index !== -1 ? shifted[index] : char;
            }).join('');
            document.getElementById('result1').textContent = `ç¼–ç ç»“æœ: ${result}`;
        }

        function shiftAlphabet(alphabet, key) {
            const shifted = [];
            const mod = 26;
            const normalizedKey = ((key % mod) + mod) % mod; // å¤„ç†è´Ÿæ•°
            for (let i = 0; i < alphabet.length; i++) {
                shifted.push(alphabet[(i + normalizedKey) % 26]);
            }
            return shifted;
        }

        function updateAlphabetRow(rowId, alphabet) {
            const row = document.getElementById(rowId);
            row.innerHTML = '';
            alphabet.forEach(char => {
                const div = document.createElement('div');
                div.textContent = char;
                row.appendChild(div);
            });
        }

        function highlightAlphabet(input, alphabet, shifted, plainRowId, cipherRowId, key) {
            const plaintextRow = document.getElementById(plainRowId);
            const ciphertextRow = document.getElementById(cipherRowId);
            clearHighlights(plaintextRow);
            clearHighlights(ciphertextRow);

            const colorMap = {};
            let colorIndex = 0;

            for (let i = 0; i < input.length; i++) {
                const char = input[i];
                const plaintextIndex = alphabet.indexOf(char);
                if (plaintextIndex !== -1) {
                    // æœ‰æ•ˆå­—æ¯ï¼šæ‰¾å‡ºåŠ å¯†åçš„å­—æ¯
                    const ciphertextChar = shifted[plaintextIndex];
                    // åœ¨å¯†æ–‡è¡Œï¼ˆæ˜¾ç¤ºçš„æ˜¯A-Zï¼‰ä¸­æ‰¾åˆ°åŠ å¯†åå­—æ¯çš„ä½ç½®
                    const ciphertextIndex = alphabet.indexOf(ciphertextChar);
                    
                    if (ciphertextIndex !== -1) {
                        if (!colorMap[plaintextIndex]) {
                            colorMap[plaintextIndex] = colors[colorIndex % colors.length];
                            colorIndex++;
                        }
                        const color = colorMap[plaintextIndex];
                        // é€»è¾‘ï¼šä¸Šè¡Œé«˜äº®æ˜æ–‡ä½ç½®ï¼Œä¸‹è¡Œé«˜äº®å¯†æ–‡ä½ç½®ï¼ˆäºŒè€…ä¼šé”™ä½ï¼Œä½“ç°åç§»ï¼‰
                        plaintextRow.children[plaintextIndex].style.backgroundColor = color;
                        ciphertextRow.children[ciphertextIndex].style.backgroundColor = color;
                        
                        // å¢åŠ æ–‡å­—é¢œè‰²å˜åŒ–ï¼Œå¢å¼ºå¯¹æ¯”åº¦
                        plaintextRow.children[plaintextIndex].style.color = '#fff';
                        ciphertextRow.children[ciphertextIndex].style.color = '#fff';
                    }
                } else {
                    // éå­—æ¯å­—ç¬¦å¤„ç†é€»è¾‘ä¿ç•™
                    const ciphertextIndex = alphabet.indexOf(char);
                    if (ciphertextIndex !== -1) {
                        const plaintextIndex = (ciphertextIndex - key + 26) % 26; // ç®€å•åæ¨é€»è¾‘
                        if (!colorMap[ciphertextIndex]) {
                            colorMap[ciphertextIndex] = colors[colorIndex % colors.length];
                            colorIndex++;
                        }
                        const color = colorMap[ciphertextIndex];
                        plaintextRow.children[plaintextIndex].style.backgroundColor = color;
                        ciphertextRow.children[ciphertextIndex].style.backgroundColor = color;
                    }
                }
            }
        }

        function clearHighlights(row) {
            Array.from(row.children).forEach(child => {
                child.style.backgroundColor = '';
                child.style.color = '#333'; // æ¢å¤æ–‡å­—é¢œè‰²
            });
        }

        // ========================
        // æ¨¡å¼2 åŠŸèƒ½ (é€»è¾‘ä¿ç•™åŸæ ·)
        // ========================
        function updateMode2Columns() {
            const ciphertext = document.getElementById('ciphertext2').value.toUpperCase();
            const container = document.getElementById('columns-container');
            container.innerHTML = '';
            const letters = ciphertext.split('');

            letters.forEach((char) => {
                if (char === ' ') {
                    const blankDiv = document.createElement('div');
                    blankDiv.classList.add('blank-column');
                    container.appendChild(blankDiv);
                } else if (/[A-Z]/.test(char)) {
                    const columnDiv = document.createElement('div');
                    columnDiv.classList.add('column');
                    const alphabet = generateColumn(char);
                    alphabet.forEach(letter => {
                        const letterDiv = document.createElement('div');
                        letterDiv.textContent = letter;
                        columnDiv.appendChild(letterDiv);
                    });
                    container.appendChild(columnDiv);
                }
            });

            // å…ˆé«˜äº®å¯†æ–‡å­—æ¯
            highlightMode2Ciphertext();
            // å†æ ¹æ®keyé«˜äº®å¯¹åº”çš„â€œæ˜æ–‡å­—æ¯â€
            updateMode2Highlight();

            // æ»šåŠ¨æ¡å¤ä½
            const wrapper = document.querySelector('.columns-wrapper');
            wrapper.scrollLeft = 0;
        }

        function generateColumn(cipherChar) {
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const cipherIndex = alphabet.indexOf(cipherChar);
            if (cipherIndex === -1) return [];
            // è®©å¯†æ–‡å­—æ¯ä½äºåˆ—ä¸­ç¬¬8è¡Œ(ç´¢å¼•7)çš„ä½ç½®
            const startIndex = (cipherIndex - 7 + 26) % 26;
            const column = [];
            for (let i = 0; i < 26; i++) {
                const index = (startIndex + i) % 26;
                column.push(alphabet[index]);
            }
            return column;
        }

        function highlightMode2Ciphertext() {
            const columns = document.querySelectorAll('.column');
            columns.forEach(column => {
                // ç¬¬8ä¸ªæ ¼ï¼ˆindex=7ï¼‰æ˜¯å¯†æ–‡å­—æ¯
                if (column.children[7]) {
                    column.children[7].classList.add('highlight-cipher');
                }
            });
        }

        function updateMode2Highlight() {
            const keyVal = parseInt(document.getElementById('key2').value);
            const key = (keyVal * (-1)) || 0;
            const columns = document.querySelectorAll('.column');

            columns.forEach(column => {
                // ç§»é™¤åŸæœ‰é«˜äº®
                column.querySelectorAll('div.highlight-plain').forEach(div => div.classList.remove('highlight-plain'));

                if (column.children[7]) {
                    // è®¡ç®—æ˜æ–‡å­—æ¯æ‰€åœ¨ä½ç½®
                    let plainIndex = (7 + key) % 26;
                    if (plainIndex < 0) {
                        plainIndex += 26;
                    }
                    if (column.children[plainIndex]) {
                        column.children[plainIndex].classList.add('highlight-plain');
                    }
                }
            });
        }
    </script>
</body>
</html>
